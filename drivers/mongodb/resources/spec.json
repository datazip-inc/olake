{
  "type": "object",
  "properties": {
    "authdb": {
      "type": "string",
      "title": "Auth DB",
      "description": "Authentication database (mostly admin)",
      "default": "admin"
    },
    "backoff_retry_count": {
      "type": "integer",
      "title": "Retry Count",
      "description": "Number of sync retry attempts using exponential backoff",
      "default": 3
    },
    "chunking_strategy": {
      "type": "string",
      "title": "Chunking Strategy",
      "description": "Chunking strategy (timestamp, uses Split Vector strategy if the field is left empty)",
      "default": "Split Vector",
      "enum": ["Split Vector", "Timestamp"]
    },
    "database": {
      "type": "string",
      "title": "Database Name",
      "description": "Name of the mongodb database selected for replication"
    },
    "hosts": {
      "type": "array",
      "title": "Hosts",
      "description": "Specifies the hostnames or IP addresses of MongoDB for connection",
      "items": {
        "type": "string"
      },
      "minItems": 1
    },
    "max_threads": {
      "type": "integer",
      "title": "Max Threads",
      "description": "Max parallel threads for chunk snapshotting",
      "default": 3
    },
    "password": {
      "type": "string",
      "title": "Password",
      "description": "Password with the username for authentication",
      "format": "password"
    },
    "read_preference": {
      "type": "string",
      "title": "Read Preference",
      "description": "Read preference for MongoDB (e.g., secondaryPreferred)"
    },
    "replica_set": {
      "type": "string",
      "title": "Replica Set",
      "description": "MongoDB replica set name (if applicable)"
    },
    "srv": {
      "type": "boolean",
      "title": "Use SRV",
      "description": "Enable this option if using DNS SRV connection strings. When set to true, the hosts field must contain only one entry - a DNS SRV address (['mongodataset.pigiy.mongodb.net'])",
      "default": false
    },
    "username": {
      "type": "string",
      "title": "Username",
      "description": "Username for MongoDB authentication"
    },
    "use_iam": {
      "type": "boolean",
      "title": "IAM Authentication",
      "description": "Enable this option to use IAM-based authentication instead of username and password",
      "default": false
    },
    "ssh_enabled": {
      "type": "boolean",
      "title": "Enable SSH Tunnel",
      "description": "Enable SSH tunneling to connect to MongoDB through a remote host",
      "default": false
    },
    "ssh_host": {
      "type": "string",
      "title": "SSH Host",
      "description": "Remote host to tunnel through (e.g., bastion or jump server)"
    },
    "ssh_port": {
      "type": "integer",
      "title": "SSH Port",
      "description": "Port for SSH connection (default: 22)",
      "default": 22
    },
    "ssh_user": {
      "type": "string",
      "title": "SSH Username",
      "description": "Username for SSH authentication"
    },
    "ssh_private_key": {
      "type": "string",
      "title": "SSH Private Key Path",
      "description": "Path to the private key file used for SSH authentication"
    }
  },

  "required": ["hosts", "database"],
  "dependencies": {
    "use_iam": {
      "oneOf": [
        {
          "properties": {
            "use_iam": {
              "const": false
            },
            "password": { "type": "string", "minLength": 1 }
          },
          "required": ["authdb", "username", "password"]
        },
        {
          "properties": {
            "use_iam": {
              "const": true
            }
          }
        }
      ]
    },
    "ssh_enabled": {
      "oneOf": [
        {
          "properties": {
            "ssh_enabled": { "const": false }
          }
        },
        {
          "properties": {
            "ssh_enabled": { "const": true },
            "ssh_host": { "type": "string" },
            "ssh_port": { "type": "integer" },
            "ssh_user": { "type": "string" },
            "ssh_private_key": { "type": "string" }
          },
          "required": ["ssh_host", "ssh_port", "ssh_user", "ssh_private_key"]
        }
      ]
    }
  }
}
